<%@page import="empty.User"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>请上传您的头像</title>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="css/default.css">
    <link href="css/fileinput.css" media="all" rel="stylesheet" type="text/css" />	
	<!--[if IE]>
		<script src="http://libs.useso.com/js/html5shiv/3.7/html5shiv.min.js"></script>
	<![endif]-->
</head>
<body>
<!-- java start -->
<%
	User user = null;
	if(session.getAttribute("user")!=null){
		user = (User)session.getAttribute("user");
	}
	String uploadimgmsg = "";
	String uploadfilename = "";
	if(request.getParameter("ilr")!=null && request.getParameter("fn")!=null){
		uploadimgmsg = request.getParameter("ilr");
	}
%>
<!-- java end -->
	<div class="htmleaf-container">
	<%if(user != null){ %>
		<header class="htmleaf-header">
			<h1>请上传您的头像 (仅仅支持 jpg, png, gif 合适的图片) <span>Please upload your avatar (only JPG, PNG, GIF)</span></h1>			
			<a href="/myblog/jsp/nav/index.jsp"><h2>返回博客主页</h2></a>	
		</header>
		<!--<div class="htmleaf-content bgcolor-8">
		</div>-->
		<div class="container kv-main">
            <div class="page-header">
            <h3>您可以点击选择按钮进行上传,也可以将图片拖拽到下面的框里 :  <small></h3>
            <h4 style="color:#FF0000">只能添加一张图片,且大小不能超过1M</h4>
            </div>
            <form enctype="multipart/form-data" action="/myblog/UpdateHeadImg?userid=<%=user.getUser_id()%>" method="post">
               		<div class="form-group">
                    <input id="file-5" class="file" type="file" multiple data-preview-file-type="any" data-upload-url="#" data-preview-file-icon="">
                </div>
                 	<input type="submit" style="width: 100%;" name="fileupload" value ="确定上传" class=" uploadbtn btn btn-success input_buttons_submit"/>
            </form>
        </div>
	</div>
	<%}else{ %>
	<h1>请先进行用户登陆</h1>	
	<a href="/myblog/jsp/nav/index.jsp"><h2>返回博客主页</h2></a>	
	<%} %>
	<script src="http://libs.useso.com/js/jquery/2.1.1/jquery.min.js"></script>
    <script src="js/fileinput.js" type="text/javascript"></script>
    <script src="js/fileinput_locale_zh.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js" type="text/javascript"></script>
    <script>
    	var errmsg = '<%=uploadimgmsg%>';
    	var altmsg = "";
    	/*
		 * 1:上传成功
		 * 2:上传失败
		 * 2.1:上传失败,格式不正确
		 * 2.2:上传失败,大小超过1M
		 * 3:上传失败,已经有该文件
		 * 4:用户未登录
		 * 5:执行sql失败
		 */

    	if(errmsg != ""){
    		if(errmsg == "1"){
    			altmsg = "上传成功";
    		}else if(errmsg == "2"){
    			altmsg = "上传失败";
    		}else if(errmsg == "2.1"){
    			altmsg = "上传失败,格式不正确";
    		}else if(errmsg == "2.2"){
    			altmsg = "上传失败,大小超过1M";
    		}else if(errmsg == "3"){
    			altmsg = "上传失败,已经有该文件";
    		}else if(errmsg == "4"){
    			altmsg = "用户未登录";
    		}else if(errmsg == "5"){
    			altmsg = "执行sql失败";
    		}
    		alert(altmsg);
    	}
    	  $("#file-0").fileinput({
  	        'allowedFileExtensions' : ['jpg', 'png','gif'],
  	    });
  	    $("#file-1").fileinput({
  	        uploadUrl: '#', // you must set a valid URL here else you will get an error
  	        allowedFileExtensions : ['jpg', 'png','gif'],
  	        overwriteInitial: false,
  	        maxFileSize: 1000,
  	        maxFilesNum: 10,
  	        //allowedFileTypes: ['image', 'video', 'flash'],
  	        slugCallback: function(filename) {
  	            return filename.replace('(', '_').replace(']', '_');
  	        }
  		});
  	    /*
  	    $(".file").on('fileselect', function(event, n, l) {
  	        alert('File Selected. Name: ' + l + ', Num: ' + n);
  	    });
  	    */
  		$("#file-3").fileinput({
  			showUpload: false,
  			showCaption: false,
  			browseClass: "btn btn-primary btn-lg",
  			fileType: "any",
  	        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>"
  		});
  		$("#file-4").fileinput({
  			uploadExtraData: {kvId: '10'}
  		});
  	    $(".btn-warning").on('click', function() {
  	        if ($('#file-4').attr('disabled')) {
  	            $('#file-4').fileinput('enable');
  	        } else {
  	            $('#file-4').fileinput('disable');
  	        }
  	    });    
  	    $(".btn-info").on('click', function() {
  	        $('#file-4').fileinput('refresh', {previewClass:'bg-info'});
  	    });
  	    /*
  	    $('#file-4').on('fileselectnone', function() {
  	        alert('Huh! You selected no files.');
  	    });
  	    $('#file-4').on('filebrowse', function() {
  	        alert('File browse clicked for #file-4');
  	    });
  	    */
  	    $(document).ready(function() {
  	        $("#test-upload").fileinput({
  	            'showPreview' : false,
  	            'allowedFileExtensions' : ['jpg', 'png','gif'],
  	            'elErrorContainer': '#errorBlock'
  	        });
  	        /*
  	        $("#test-upload").on('fileloaded', function(event, file, previewId, index) {
  	            alert('i = ' + index + ', id = ' + previewId + ', file = ' + file.name);
  	        });
  	        */
  	    });
		</script>
</body>
</html>